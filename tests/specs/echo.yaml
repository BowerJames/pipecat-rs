version: 1
name: echo
fail_after: 100ms
default_within: 50ms

pipeline:
  - type: transport@simulated@input
    name: input
  - type: echo
    name: echo
  - type: transport@simulated@output
    name: output

script:
  - op: await
    node: input
    direction: downstream
    pattern:
      type: text_input
      body:
        text: "Hello, world!"
    within: 50ms

  - op: send
    node: input
    direction: downstream
    after: 10ms
    pattern:
      type: text_input
      body:
        text: "Hello, world!"

  - op: await
    node: echo
    direction: downstream
    pattern:
      type: text_input
      body:
        text: "Hello, world!"
    within: 50ms

  - op: send
    node: echo
    direction: downstream
    after: 10ms
    pattern:
      type: text_output
      body:
        text: "Hello, world!"

  - op: await
    node: output
    direction: downstream
    pattern:
      type: text_output
      body:
        text: "Hello, world!"
    within: 60ms